name: Compress and Optimize Images
on:
  push:
    paths:
      - 'public/images/**'
      - '**.jpg'
      - '**.jpeg'
      - '**.png'
  pull_request:
    paths:
      - 'public/images/**'
      - '**.jpg'
      - '**.jpeg'
      - '**.png'
  workflow_dispatch:

jobs:
  optimize:
    name: ðŸ–¼ï¸ Optimize Images
    runs-on: ubuntu-latest
    
    # ÙÙ‚Ø· Ø¹Ù„Ù‰ push Ù„Ù„Ù€ main branch Ø£Ùˆ Ø¹Ù„Ù‰ pull requests
    if: github.event_name == 'pull_request' || github.ref == 'refs/heads/main'
    
    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ—œï¸ Compress Images
        id: compress
        uses: calibreapp/image-actions@main
        with:
          githubToken: ${{ secrets.GITHUB_TOKEN }}
          # Ø¶ØºØ· ÙˆØ¥Ù†Ø´Ø§Ø¡ WebP
          compressOnly: false
          # Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¶ØºØ·
          jpegQuality: '80'
          pngQuality: '80..90'
          webpQuality: '80'
          # ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙˆØ± Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹
          ignorePaths: 'node_modules/**,dist/**'

      - name: ðŸ“Š Output Results
        if: steps.compress.outputs.markdown != ''
        run: |
          echo "## ðŸ–¼ï¸ Image Optimization Results" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.compress.outputs.markdown }}" >> $GITHUB_STEP_SUMMARY
