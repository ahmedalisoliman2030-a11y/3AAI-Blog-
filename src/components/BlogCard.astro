---
/**
 * بطاقة المقال (Blog Card)
 * تعرض ملخصاً للمقال مع الصورة والعنوان والوصف.
 * تستخدم في صفحة المقالات والصفحة الرئيسية.
 */
import { formatDate } from "../utils/date";
import { calculateReadingTime, formatReadingTime } from "../utils/reading-time";
import OptimizedImage from "./OptimizedImage.astro";

interface Props {
  /** عنوان المقال */
  title: string;
  /** وصف مختصر للمقال */
  description: string;
  /** تاريخ النشر */
  date: Date;
  /** اسم الكاتب */
  author: string;
  /** رابط الصورة البارزة (اختياري) */
  image?: string;
  /** تصنيف المقال */
  category: string;
  /** قائمة الوسوم */
  tags: string[];
  /** الرابط اللطيف (Slug) للمقال */
  slug: string;
  /** محتوى المقال (لحساب وقت القراءة) */
  content?: string;
}

const {
  title,
  description,
  date,
  author,
  image,
  category,
  tags,
  slug,
  content,
} = Astro.props;

const readingTime = content ? calculateReadingTime(content) : 0;
---

<article class="blog-card">
  {
    image && (
      <a href={`/blog/${slug}`} class="card-image-link">
        <OptimizedImage
          src={image}
          alt={title}
          class="card-image"
          loading="lazy"
          width={800}
          height={400}
          widths={[400, 600, 800]}
          sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 400px"
        />
      </a>
    )
  }

  <div class="card-content">
    <div class="card-meta">
      <span class="card-category">{category}</span>
      <time class="card-date" datetime={date.toISOString()}>
        {formatDate(date, "short")}
      </time>
    </div>

    <h3 class="card-title">
      <a href={`/blog/${slug}`}>{title}</a>
    </h3>

    <p class="card-description">{description}</p>

    <div class="card-footer">
      <div class="card-author-info">
        <span class="card-author">{author}</span>
        {
          readingTime > 0 && (
            <span class="card-reading-time">
              {formatReadingTime(readingTime)}
            </span>
          )
        }
      </div>

      {
        tags.length > 0 && (
          <div class="card-tags">
            {tags.slice(0, 3).map((tag) => (
              <span class="card-tag">{tag}</span>
            ))}
          </div>
        )
      }
    </div>
  </div>
</article>

<style>
  .blog-card {
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all var(--transition-normal);
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .blog-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--color-border-hover);
  }

  .card-image-link {
    display: block;
    overflow: hidden;
  }

  .card-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    transition: transform var(--transition-slow);
  }

  .blog-card:hover .card-image {
    transform: scale(1.05);
  }

  .card-content {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .card-meta {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
    font-size: 0.875rem;
  }

  .card-category {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background-color: var(--color-primary);
    color: white;
    border-radius: var(--radius-md);
    font-weight: 500;
    font-size: 0.75rem;
  }

  .card-date {
    color: var(--color-text-muted);
  }

  .card-title {
    font-size: 1.25rem;
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  .card-title a {
    color: var(--color-text);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .card-title a:hover {
    color: var(--color-primary);
  }

  .card-description {
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin-bottom: auto;
    flex: 1;
  }

  .card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 1rem;
    margin-top: 1rem;
    border-top: 1px solid var(--color-border);
    gap: 1rem;
  }

  .card-author-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .card-author {
    color: var(--color-text-muted);
    font-size: 0.875rem;
  }

  .card-reading-time {
    color: var(--color-text-muted);
    font-size: 0.75rem;
  }

  .card-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .card-tag {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background-color: var(--color-surface-hover);
    color: var(--color-text-secondary);
    border-radius: var(--radius-sm);
  }

  @media (max-width: 768px) {
    .card-footer {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>
