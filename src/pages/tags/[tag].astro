---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import BlogCard from "../../components/BlogCard.astro";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const publishedPosts = allPosts.filter(post => !post.data.draft);
  
  const tags = [...new Set(publishedPosts.flatMap(post => post.data.tags || []))];
  
  return tags.map(tag => ({
    params: { tag },
    props: {
      posts: publishedPosts.filter(post => (post.data.tags || []).includes(tag)),
      tag
    }
  }));
}

const { posts, tag } = Astro.props;
---

<BaseLayout title={`الوسم: ${tag}`} description={`جميع المقالات الموسومة بـ ${tag}`}>
  <div class="container">
    <h1>الوسم: {tag}</h1>
    <p class="subtitle">عدد المقالات: {posts.length}</p>
    
    <div class="posts-grid">
      {posts.map(post => (
        <BlogCard post={post} />
      ))}
    </div>
    
    <div class="back-link">
      <a href="/blog">← العودة إلى جميع المقالات</a>
    </div>
  </div>
</BaseLayout>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
  }
  
  .subtitle {
    color: var(--text-secondary);
    margin-bottom: 2rem;
  }
  
  .posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
  }
  
  .back-link {
    margin-top: 2rem;
  }
  
  .back-link a {
    color: var(--primary-color);
    text-decoration: none;
  }
  
  .back-link a:hover {
    text-decoration: underline;
  }
</style>
